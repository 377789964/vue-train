{
  "version": 3,
  "sources": ["../src/effect.ts", "../../shared/src/index.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["// import { ReactiveEffect } from \"vue\";\nexport let activeEffect;\n\nclass ReactiveEffect {\n    public active = true;\n    public deps = [];\n    public parent = undefined\n    constructor(public fn) {}\n    run() {\n        if(!this.active) { // \u505C\u6B62\u64CD\u4F5C\n            return this.fn() // \u76F4\u63A5\u6267\u884C\u51FD\u6570\n        }\n        // \u5176\u4ED6\u72B6\u6001 \u610F\u5473\u7740\u662F\u6FC0\u6D3B\u7684\u72B6\u6001\n        try {\n            this.parent = activeEffect\n            activeEffect = this\n            return this.fn()\n        } finally {\n            activeEffect = this.parent\n            this.parent = undefined\n        }\n        \n    }\n}\n// \u4F9D\u8D56\u6536\u96C6\u5C31\u662F\u5427\u5F53\u524D\u7684efect\u53D8\u6210\u5168\u5C40\u7684\uFF0C\u7A0D\u540E\u53D6\u503C\u7684\u65F6\u5019\u53EF\u4EE5\u62FF\u5230\u8FD9\u4E2A\nexport function effect(fn) {\n    const _effect = new ReactiveEffect(fn)\n    _effect.run(); // \u9ED8\u8BA4\u6267\u884C\u4E00\u6B21\n\n}\n\n// let mapping = {\n//     target: {\n//         name: [activeEffect]\n//     }\n// }\nconst targetMap = new WeakMap();\nexport function track(target, key) {\n    if(!activeEffect) {\n        // \u8868\u793A\u53D6\u503C\u64CD\u4F5C\u4E0D\u5728effect\u4E2D\n        return\n    }\n    let depsMap = targetMap.get(target)\n    if(!depsMap) {\n        // WeakMap\u4E2D\u7684key\u53EA\u80FD\u662F\u5BF9\u620F\u90A3\u4E2A\uFF0C\u6240\u4EE5\u5F53\u524D\u4F7F\u7528map\u6570\u636E\u7C7B\u578B\n        targetMap.set(target, (depsMap = new Map()))\n    }\n    let dep = depsMap.get(key)\n    if(!dep) {\n        depsMap.set(key, (dep = new Set()))\n    }\n    let shouldTrack = !dep.has(activeEffect)\n    if(shouldTrack) {\n        dep.add(activeEffect)\n        activeEffect.deps.push(dep);\n    }\n    console.log(targetMap, depsMap, activeEffect)\n}\n", "export function isObject(value) {\n    return value !== null && typeof value == 'object'\n}", "import { activeEffect, track } from \"./effect\";\nimport { ReactiveFlags } from \"./reactive\"\n\nexport const mutableHandlers = {\n    get(target, key, receiver) { // \u7528\u6237\u53D6\u503C\u64CD\u4F5C\n        if (ReactiveFlags.IS_REACTIVE === key) {\n          return true  \n        }\n        track(target, key)\n        return Reflect.get(target, key, receiver);\n    },\n    set(target, key, value, receiver) { // \u7528\u6237\u8D4B\u503C\u64CD\u4F5C\n        return Reflect.set(target, key, value, receiver);\n    }\n}\n", "import { isObject } from \"@vue/shared\";\nimport { mutableHandlers } from \"./baseHandler\"\n\nexport const enum ReactiveFlags {\n    IS_REACTIVE = \"__v_isReactive\"\n}\n\n// const mutableHandlers = {\n//     get(target, key, receiver) {\n//         if (ReactiveFlags.IS_REACTIVE === key) {\n//           return true  \n//         }\n//         return Reflect.get(target, key, receiver);\n//     },\n//     set(target, key, value, receiver) {\n//         return Reflect.set(target, key, value, receiver);\n//     }\n// }\n\nconst reactiveMap = new WeakMap(); // key \u53EA\u80FD\u662F\u5BF9\u8C61\nexport function reactive(target) {\n    if (!isObject(target)) {\n        return target;\n    }\n   \n    // \u4EE3\u7406\u5BF9\u8C61\u7684\u8FD4\u56DE\u503C\u88AB\u4EE3\u7406\uFF0C\u8FD4\u56DE\u4E4B\u524D\u88AB\u4EE3\u7406\u7684\u7ED3\u679C\n    if (target[ReactiveFlags.IS_REACTIVE]) {\n        return target\n    } \n\n    // \u7F13\u5B58\u4E00\u4E0B\uFF0C\u4EE3\u7406\u8FC7\u7684\u5BF9\u8C61\uFF0C\u518D\u8FDB\u884C\u4EE3\u7406\u7684\u65F6\u5019\u76F4\u63A5\u62FF\u51FA\u6765\u8FD4\u56DE\u5373\u53EF\n    const existsProxy = reactiveMap.get(target);\n    if (existsProxy) {\n        return existsProxy;\n    }\n\n    // \u4EE3\u7406 \u6211\u901A\u8FC7\u4EE3\u7406\u5BF9\u8C61\u64CD\u4F5C\u5C5E\u6027 \u4F60\u4F1A\u53BB\u6E90\u5BF9\u8C61\u4E0A\u8FDB\u884C\u83B7\u53D6\n    const proxy = new Proxy(target, mutableHandlers);\n    reactiveMap.set(target, proxy);\n    \n    return proxy\n}\n\n\n"],
  "mappings": ";AACO,IAAI;AAEX,IAAM,iBAAN,MAAqB;AAAA,EAIjB,YAAmB,IAAI;AAAJ;AAHnB,SAAO,SAAS;AAChB,SAAO,OAAO,CAAC;AACf,SAAO,SAAS;AAAA,EACQ;AAAA,EACxB,MAAM;AACF,QAAG,CAAC,KAAK,QAAQ;AACb,aAAO,KAAK,GAAG;AAAA,IACnB;AAEA,QAAI;AACA,WAAK,SAAS;AACd,qBAAe;AACf,aAAO,KAAK,GAAG;AAAA,IACnB,UAAE;AACE,qBAAe,KAAK;AACpB,WAAK,SAAS;AAAA,IAClB;AAAA,EAEJ;AACJ;AAEO,SAAS,OAAO,IAAI;AACvB,QAAM,UAAU,IAAI,eAAe,EAAE;AACrC,UAAQ,IAAI;AAEhB;AAOA,IAAM,YAAY,oBAAI,QAAQ;AACvB,SAAS,MAAM,QAAQ,KAAK;AAC/B,MAAG,CAAC,cAAc;AAEd;AAAA,EACJ;AACA,MAAI,UAAU,UAAU,IAAI,MAAM;AAClC,MAAG,CAAC,SAAS;AAET,cAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,EAC/C;AACA,MAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,MAAG,CAAC,KAAK;AACL,YAAQ,IAAI,KAAM,MAAM,oBAAI,IAAI,CAAE;AAAA,EACtC;AACA,MAAI,cAAc,CAAC,IAAI,IAAI,YAAY;AACvC,MAAG,aAAa;AACZ,QAAI,IAAI,YAAY;AACpB,iBAAa,KAAK,KAAK,GAAG;AAAA,EAC9B;AACA,UAAQ,IAAI,WAAW,SAAS,YAAY;AAChD;;;ACzDO,SAAS,SAAS,OAAO;AAC5B,SAAO,UAAU,QAAQ,OAAO,SAAS;AAC7C;;;ACCO,IAAM,kBAAkB;AAAA,EAC3B,IAAI,QAAQ,KAAK,UAAU;AACvB,+CAAkC,KAAK;AACrC,aAAO;AAAA,IACT;AACA,UAAM,QAAQ,GAAG;AACjB,WAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,EAC5C;AAAA,EACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAC9B,WAAO,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AAAA,EACnD;AACJ;;;ACXO,IAAW,gBAAX,kBAAWA,mBAAX;AACH,EAAAA,eAAA,iBAAc;AADA,SAAAA;AAAA,GAAA;AAgBlB,IAAM,cAAc,oBAAI,QAAQ;AACzB,SAAS,SAAS,QAAQ;AAC7B,MAAI,CAAC,SAAS,MAAM,GAAG;AACnB,WAAO;AAAA,EACX;AAGA,MAAI,OAAO,qCAA4B;AACnC,WAAO;AAAA,EACX;AAGA,QAAM,cAAc,YAAY,IAAI,MAAM;AAC1C,MAAI,aAAa;AACb,WAAO;AAAA,EACX;AAGA,QAAM,QAAQ,IAAI,MAAM,QAAQ,eAAe;AAC/C,cAAY,IAAI,QAAQ,KAAK;AAE7B,SAAO;AACX;",
  "names": ["ReactiveFlags"]
}
